---
title: "Project3"
author: "Gabrielle Bartomeo, Binish Chandy, Zach Dravis, Burcu Kaniskan, Niteen Kumar, Betsy Rosalen"
date: "March 25, 2018"
output: 
  html_document:
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: false
    number_section:  true
    theme: cerulean
    highlight:  tango
editor_options: 
  chunk_output_type: inline
runtime: shiny
---


```{r setup, include=FALSE}
library(knitr)
library(tidyverse)
library(DT)
library(kableExtra)
library(lubridate)
library(janitor)
library(likert)
#library(reshape)
#library(plotly)
library(gridExtra)
library(scales)
knitr::opts_chunk$set(echo = TRUE)
```

# Importing data

The data set used in this project is [Kaggle ML and Data Science Survey 2017](https://www.kaggle.com/kaggle/kaggle-survey-2017/feed). The survey was stored in 2 different data sets:a) multiple choice items, b) free-response items. Kaggle stored each data in csv format. We downloaded the multiple choice item survey results in csv format and placed it in our [GitHub repo](https://github.com/betsyrosalen/DATA_607_Project_3)

Importing Multiple Choice data
```{r message=FALSE ,warning=FALSE}
linkMC<-"https://raw.githubusercontent.com/betsyrosalen/DATA_607_Project_3/master/project3_master/rawdata/multipleChoiceResponses.csv"
#importing MC items
MC<-read_csv (linkMC)
#lets create a unique ID variable 
MC$id <- seq.int(nrow(MC))
```

```{r message=FALSE ,warning=FALSE}
# Ignore this code Importing conversion rates data incase we want to do analyses 

# link_conversion<-"https://raw.githubusercontent.com/betsyrosalen/DATA_607_Project_3/master/project3_master/rawdata/conversionRates.csv"
# #importing MC items
# conversion<-read_csv (link_conversion)
# dim(conversion)
# #lets create a unique ID variable 
# conversion$id <- seq.int(nrow(conversion))
```


# Research Question

This project will answer the global research question **Which are the most values data science skills?**

# Research Question 1

What is the relationship between the most popular platforms for learning DS and X (Niteen)?
Alternatively phrased: What data science learning resources and which locations of open data are utilized by people of varying levels of education? (delete me if you need to!)

## Variables and their definition 

This section will describe the name of the variables and their labels (as reported in schema doc) and how the values were codes (etc yes, no, select all)

## Manipulating data

## Exploratory Data Analysis (EDA)

```{r}

```


# Research Question 2

Does survey takers' formal education has any relationship to the ML/DS method he
or she is most excited about learning in the next year?

To do the analysis, we concentrate on two colums in the dataset -
FormalEducation and MLMethodNextYearSelect

FormalEducation : Which level of formal education have you attained?
MLMethodNextYearSelect : Which ML/DS method are you most excited about learning 
in the next year?
These questions are asked to all participants.

```{r, echo=FALSE}
# removing NAs as they are not meaningful
subset <- MC %>%
        filter(!is.na(FormalEducation), !is.na(MLMethodNextYearSelect)) %>%
        select(FormalEducation, MLMethodNextYearSelect) %>%
        filter(FormalEducation != "I prefer not to answer") %>%
        mutate (FormalEducation=as.factor(FormalEducation)) %>%
        mutate (FormalEducation=recode_factor(FormalEducation,
                "Bachelor's degree"='Bachelor',
      "Some college/university study without earning a bachelor's degree"=
                                                      'College Dropout',
                                              'Doctoral degree'='Doctoral',
                                              "Master's degree"='Masters',
                                              'Professional degree'=
                                                      'Professional' ,
                'I did not complete any formal education past high school'=
                                                      'High School'))

```

First we plot the distribution of formal education in the dataset

```{r, echo=FALSE}
subset %>%
        ggplot() +
        geom_bar(mapping = aes(x = FormalEducation, y = ..prop.., group = 1, fill = FormalEducation),
                 show.legend = FALSE) +
        coord_flip() +
        labs (y="Proportion", x="Formal Education" , title="Distribution of Formal Education")
```
The data set predominantly contains candidates with Master's degree.   
Now let's look at the different ML/DS methods in the dataset

```{r, echo=FALSE}
kable(unique(subset$MLMethodNextYearSelect), col.names = c("ML/DS Methods"))
```

Now we can plot the distribution of ML/DS methods with formal education
```{r, fig.height = 15, fig.width = 15, fig.align = "center" , message= FALSE, echo=FALSE}
subset %>%
        ggplot() + 
        geom_bar(mapping = aes(x = MLMethodNextYearSelect, fill = MLMethodNextYearSelect)) +
                 coord_flip() + 
                 theme(legend.position="bottom")+
                 facet_wrap (~FormalEducation)+
                 theme(axis.text.x = element_text(angle = 90), legend.position = 'none') +
                 labs (x="ML Method ", y="count " , title="FormalEducation vs MLMethodNextYearSelect")
```
```{r, echo=FALSE}
result <- subset %>%
        group_by(FormalEducation, MLMethodNextYearSelect) %>%
        summarise(count = n()) %>%
        mutate(percentage = round(count / sum(count), 2)) %>%
         mutate(rank = min_rank(desc(percentage))) %>%  
        filter(rank %in% c(1,2,3)) %>%
        select(-count, -rank) %>%
        arrange(FormalEducation, desc(percentage)) 
kable(result)
```


Deep Learning is the top most ML/DS method in all categories of formal education
followed by Neural Nets. Except High school graduates, all others wants to learn
Time Series Analysis as the third ML/DS method. High school graduates want to 
learn Genetic & Evolutionary Algorithms as theri third choice. Among doctoral 
survey takers, Bayesian Methods is the third preference.

# Research Question 3

What are the most frequently used data science (DS) methods by those writing code in DS professions? Do those relate to formal educational attainment? (Zach)

## Variables and their definition 

The following variables label questions asking survey respondents how often they use each of these data science methods.  Response options were: Rarely, Sometimes, Often, Most of the time
- WorkMethodsFrequencyA/B
- WorkMethodsFrequencyAssociationRules
- WorkMethodsFrequencyBayesian
- WorkMethodsFrequencyCNNs
- WorkMethodsFrequencyCollaborativeFiltering
- WorkMethodsFrequencyCross-Validation
- WorkMethodsFrequencyDataVisualization
- WorkMethodsFrequencyDecisionTrees
- WorkMethodsFrequencyEnsembleMethods
- WorkMethodsFrequencyEvolutionaryApproaches
- WorkMethodsFrequencyGANs
- WorkMethodsFrequencyGBM
- WorkMethodsFrequencyHMMs
- WorkMethodsFrequencyKNN
- WorkMethodsFrequencyLiftAnalysis
- WorkMethodsFrequencyLogisticRegression
- WorkMethodsFrequencyMLN
- WorkMethodsFrequencyNaiveBayes
- WorkMethodsFrequencyNLP
- WorkMethodsFrequencyNeuralNetworks
- WorkMethodsFrequencyPCA
- WorkMethodsFrequencyPrescriptiveModeling
- WorkMethodsFrequencyRandomForests
- WorkMethodsFrequencyRecommenderSystems
- WorkMethodsFrequencyRNNs
- WorkMethodsFrequencySegmentation
- WorkMethodsFrequencySimulation
- WorkMethodsFrequencySVMs
- WorkMethodsFrequencyTextAnalysis
- WorkMethodsFrequencyTimeSeriesAnalysis

The additional variables used for this analysis will include:
- Formal Education

## Manipulating data
```{r}
#Subset Data
MethodsData <- MC %>%
  select(FormalEducation, contains("WorkMethods"))

#Filter data based on who answered the methods questions, which were only given to coding workers employed in some capacity
MethodsData <- MethodsData[!is.na(MethodsData$WorkMethodsSelect),]

#Most popular techniques that respondents report using at least rarely
MasterString <- MethodsData$WorkMethodsSelect
Options <- str_c(MasterString, collapse = "")
Options <- unlist(str_split(MasterString, pattern = ","))
Options <- as.data.frame(table(Options))
MethodsFrequency <- arrange(Options, desc(Freq))

#Find out when one knows a technique, how frequently they use it
#Rarely, Sometimes, Often, Most of the time
MethodsScored <- MethodsData %>%
  select(-c(WorkMethodsSelect))
MethodsScored[MethodsScored=="Rarely"]<-1
MethodsScored[MethodsScored=="Sometimes"]<-2
MethodsScored[MethodsScored=="Often"]<-3
MethodsScored[MethodsScored=="Most of the time"]<-4

MethodsScored$WorkMethodsFrequencyDataVisualization <- as.integer(MethodsScored$WorkMethodsFrequencyDataVisualization)
AvgFreqDataVis <- sum(MethodsScored$WorkMethodsFrequencyDataVisualization, na.rm = T) / sum(!is.na(MethodsScored$WorkMethodsFrequencyDataVisualization))

MethodsScored$WorkMethodsFrequencyLogisticRegression <- as.integer(MethodsScored$WorkMethodsFrequencyLogisticRegression)
AvgFreqLogRegress <- sum(MethodsScored$WorkMethodsFrequencyLogisticRegression, na.rm = T) / sum(!is.na(MethodsScored$WorkMethodsFrequencyLogisticRegression))

MethodsScored$`WorkMethodsFrequencyCross-Validation` <- as.integer(MethodsScored$`WorkMethodsFrequencyCross-Validation`)
AvgFreqCrossValid <- sum(MethodsScored$`WorkMethodsFrequencyCross-Validation`, na.rm = T) / sum(!is.na(MethodsScored$`WorkMethodsFrequencyCross-Validation`))

MethodsScored$WorkMethodsFrequencyDecisionTrees <- as.integer(MethodsScored$WorkMethodsFrequencyDecisionTrees)
AvgFreqDecisionTrees <- sum(MethodsScored$WorkMethodsFrequencyDecisionTrees, na.rm = T) / sum(!is.na(MethodsScored$WorkMethodsFrequencyDecisionTrees))

MethodsScored$WorkMethodsFrequencyRandomForests <- as.integer(MethodsScored$WorkMethodsFrequencyRandomForests)
AvgFreqRandomForest <- sum(MethodsScored$WorkMethodsFrequencyRandomForests, na.rm = T) / sum(!is.na(MethodsScored$WorkMethodsFrequencyRandomForests))

Top5FreqScore <- data.frame(Method = c("Data Visualization", "Logistic Regression", "Cross Validation", "Decision Trees", "Random Forests"), FrequencyScore = c(AvgFreqDataVis, AvgFreqLogRegress, AvgFreqCrossValid, AvgFreqDecisionTrees, AvgFreqRandomForest))

#Group and create methods frequency for each level of educational attainment
EducationData <- MethodsData %>%
  select(FormalEducation, WorkMethodsSelect) %>%
  filter(FormalEducation != "I prefer not to answer") %>%
  na.omit()

HighSchoolEducation <- EducationData %>%
  filter(FormalEducation == "I did not complete any formal education past high school")

SomePostSecondaryEducation <- EducationData %>%
  filter(FormalEducation == "Some college/university study without earning a bachelor\'s degree")

ProfessionalEducation <- EducationData %>%
  filter(FormalEducation == "Professional degree")

BachelorsEducation <- EducationData %>%
  filter(FormalEducation == "Bachelor's degree")

MastersEducation <- EducationData %>%
  filter(FormalEducation == "Master's degree")

DoctoralEducation <- EducationData %>%
  filter(FormalEducation == "Doctoral degree")

MethodFrequencyFunction <- function(x){
  BigString <- x$WorkMethodsSelect
  Selections <- str_c(BigString, collapse = "")
  Selections <- unlist(str_split(BigString, pattern = ","))
  TempDF <- as.data.frame(table(Selections))
  TempDF <- TempDF %>%
    mutate(RelativeFreq = Freq / sum(Freq))
  return(TempDF)
}

HighSchoolEducation <- MethodFrequencyFunction(HighSchoolEducation)
SomePostSecondaryEducation <- MethodFrequencyFunction(SomePostSecondaryEducation)
ProfessionalEducation <- MethodFrequencyFunction(ProfessionalEducation)
BachelorsEducation <- MethodFrequencyFunction(BachelorsEducation)
MastersEducation <- MethodFrequencyFunction(MastersEducation)
DoctoralEducation <- MethodFrequencyFunction(DoctoralEducation)
```


## Exploratory Data Analysis (EDA)

```{r}
MethodsFrequencyPlot <- ggplot(MethodsFrequency, aes(x = reorder(Options, -Freq), y = Freq, fill = Options)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  ggtitle("Frequency of Enodrsements for DS Methods") + 
  xlab("Number of Endorsements") +
  ylab("Data Science Method") +
  guides(fill = F)

Top5EndorsedFreqScorePlot <- ggplot(Top5FreqScore, aes(x = reorder(Method, -FrequencyScore), y = FrequencyScore, fill = Method)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  ggtitle("Average Frequency Scores for Top 5 Endorsed DS Methods") + 
  xlab("Average Frequency Score") +
  ylab("Data Science Method")

MethodsFrequencyPlot
Top5EndorsedFreqScorePlot

kable(MethodsFrequency)
```


```{r, fig.height = 15, fig.width = 15, fig.align = "center"}
HighSchoolPlot <- ggplot(HighSchoolEducation, aes(x = Selections, y = RelativeFreq, fill = Selections)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  ggtitle("High School Education Methods Usage") +
  guides(fill = F)

SomeSchoolPlot <- ggplot(SomePostSecondaryEducation, aes(x = Selections, y = RelativeFreq, fill = Selections)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  ggtitle("Some Post Secondary Education Methods Usage") +
  guides(fill = F)

ProfessionalPlot <- ggplot(ProfessionalEducation, aes(x = Selections, y = RelativeFreq, fill = Selections)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  ggtitle("Professional Education Methods Usage") +
  guides(fill = F)

BachelorsPlot <- ggplot(BachelorsEducation, aes(x = Selections, y = RelativeFreq, fill = Selections)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  ggtitle("Bachelor's Education Methods Usage") +
  guides(fill = F)

MastersPlot <- ggplot(MastersEducation, aes(x = Selections, y = RelativeFreq, fill = Selections)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  ggtitle("Master's Education Methods Usage") +
  guides(fill = F)

DoctoralPlot <- ggplot(DoctoralEducation, aes(x = Selections, y = RelativeFreq, fill = Selections)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  ggtitle("Doctoral Education Methods Usage") +
  guides(fill = F)

grid.arrange(HighSchoolPlot, SomeSchoolPlot, ProfessionalPlot, BachelorsPlot, MastersPlot, DoctoralPlot, nrow = 2)

HighSchoolEducation$Degree <- "High School Education"
SomePostSecondaryEducation$Degree <- "Some Post Secondary Education"
ProfessionalEducation$Degree <- "Professional Education"
BachelorsEducation$Degree <- "Bachelor's Education"
MastersEducation$Degree <- "Master's Education"
DoctoralEducation$Degree <- "Doctoral Education"
```


```{r}
AllEducations <- rbind(HighSchoolEducation, SomePostSecondaryEducation, ProfessionalEducation, BachelorsEducation, MastersEducation, DoctoralEducation)

Top3EachDegree <- AllEducations %>%
  group_by(Degree) %>%
  arrange(desc(RelativeFreq)) %>%
  slice(1:3)

kable(Top3EachDegree)
```


# 'Learners' vs. Employed Data Scientists

```{r message=FALSE ,warning=FALSE, echo=FALSE}
#Re-import MC items using read.csv so that I can use the likert package
MC2<-read.csv(linkMC, stringsAsFactors = FALSE)
#lets create a unique ID variable 
MC2$id <- seq.int(nrow(MC2))
```

## Question

Is there a difference between what 'Learners' think are the important skills to learn and what employed Data Scientists say are the skills and tools they are using?

Those who are new to data science and learning new skills may have different opinions about which tools and methods are most important to learn and which are being used than those who are already employed in the field. Comparing the answer of 'Learners' vs. employed Data Scientists may give us some insight into which skills each group values most and whether or not they are in agreement.

## Variables and their definition

A large portion of the data collected in the Kaggle survey was in the form of Likert scales asking respondents to place the value, importance, or frequency of use of certain skills, tools and methods on a 3-4 point scale.  To answer our question about which are the 'most valued' data science skills we looked a these scales and analyzed for differences between what 'Learners' thought was important to them vs. what employed data scientists say they are using in the field.  

An oversight in the survey is that they failed to capture the opinions of those who are employed about what they thought were the most important job skills.  They didn't bother to ask employed respondents those questions, so comparisons between employed data scientists and learners are a little more difficult.  We can only use the data about what tools and methods employed data scientists are actually using and the frequency of their use to infer the importance of those tools and methods.  The Survey also failed to capture those who are employed and ALSO students or learners!  They didn't bother to ask employed respondents if they were also studying Data Science.  Professional development is critical in a field that is growing and changing as rapidly as data science, so asking employed professionals about their further studies could have been very useful information to have.  Working Data Scientists may have a better insight into what direction the field is going in than students who are just in the learning phase of their journey.

## Manipulating data

Out of the 229 variables of data collected in the survey, about 105 of them fall into 5 likert scales describing, the "Learning Platform Usefulness" (which was asked of both learners and employed data scientists), "Job Skill Importance" (which only unemployed learners were asked), "Work Tools Frequency" and "WorkMethodsFrequency" (which only employed data scientists were asked to answer).  We narrowed down the data to include only these as well as a few more basic demographic fields to get a sense of who the respondents are.

We also chose to focus only on respondents who are located in the US since international cultural and technological differences may skew results.  Different tools and skills may be more or less valued in different countries, so we thought it best to narrow the focus on one country at a time.  Further analysis to see if the findings are consistent across countries would be interesting and worthwhile.

```{r, echo=FALSE}
# Select only variables that seem most related to “Which are the most valued data science skills?”
# Filter for US Only
USOnly <- MC2 %>%
  select(-c(56:73, 76:79, 167:196, 198:228)) %>%
  filter(Country=='United States')

cols <- str_replace(names(USOnly), "LearningPlatformUsefulness", "LPU-")
cols <- str_replace(cols, "JobSkillImportance", "JSI-")
cols <- str_replace(cols, "WorkToolsFrequency", "WTF-")
cols <- str_replace(cols, "WorkMethodsFrequency", "WMF-")
names(USOnly) <- cols
remove(MC2)
```

```{r warning=FALSE, include=FALSE}
# Separate those employed in Data Science from those who are not.

# Filter for Employed only, TitleFit better than 'Poorly', and CodeWriters only
# Remove those that said they are "Employed by a company that doesn't perform advanced analytics"
employed <- USOnly %>%
  filter(!grepl('Not employed',EmploymentStatus), 
         TitleFit!="Poorly",
         !grepl('doesn\'t perform advanced analytics',CurrentEmployerType),
         CodeWriter=="Yes",
         JobFunctionSelect != 'Build and/or run the data infrastructure')
  
# Filter for Data Science Learners who are not employed.  
# The Survey failed to capture those who are employed and ALSO students or learners!!!  
# Didn't bother to ask employed respondents if they were also sudying Data Science.
learner <- USOnly %>%
  filter(grepl('Not employed',EmploymentStatus),
         grepl('Yes',LearningDataScience))

# Change empty strings to NA
is.na(employed) <- employed == ""
is.na(learner) <- learner == ""

# Get rid of empty columns 
employed <- remove_empty(employed, c("cols"))
learner <- remove_empty(learner, c("cols"))
glimpse(employed)
glimpse(learner)
```

```{r, include=FALSE}
# Change columns to factors

flevels <- function(x){
  factor(x, order=TRUE, levels=c("Not Useful", "Somewhat useful", "Very useful"))
}
flevels2 <- function(x){
  factor(x, order=TRUE, levels=c("Rarely", "Sometimes", "Often", "Most of the time"))
}
flevels3 <- function(x){
  factor(x, order=TRUE, levels=c("Unnecessary", "Nice to have", "Necessary"))
}

employed[,14:31] <- lapply(employed[,14:31], flevels)
employed[,39:86] <- lapply(employed[,39:86], flevels2)
employed[,91:120] <- lapply(employed[,91:120], flevels2)

learner[,12:28] <- lapply(learner[,12:28], flevels)
learner[,31:40] <- lapply(learner[,31:40], flevels3)

employed.LP <- employed[,14:31]
employed.WT <- employed[,39:86]
employed.WM <- employed[,91:120]

learner.LP <- learner[,12:28]
learner.JS <- learner[,31:40]
```

## Exploratory Data Analysis (EDA)

First let's take a look at the demographics of the survey respondents and what type of jobs they hold. 

### Employed Data Scientists

About 30% of or survey respondents would call themselves "Data Scientists" with about another 20 percent calling themselves either "Scientist/Researcher" or "Software Developer/Software Engineer".  So about 50% of our survey respondents fall in these three categories with the other 50% in other roles.  

```{r echo=FALSE}
# Take a peek at the demographics of those who are employed...
kable(employed %>% 
  group_by(CurrentJobTitleSelect) %>%
  summarise(total = n()) %>%
  mutate(percent = round(total / sum(total), 4)*100) %>%
  arrange(desc(total)))

# Need to Tidy this data so that each response is in a separate row rather than all in one
# employed %>% 
#  group_by(CurrentEmployerType) %>%
#  summarise(total = n()) %>%
#  arrange(desc(total))
```

### 'Learners'

The Kaggle survey asked respondents if they were learning data science and their student status.  73% of the respondents who said they were learning data science are enrolled in an academic program.  

```{r echo=FALSE}
# Take a peek at the demographics of those who are learners...
kable(learner %>% 
  group_by(StudentStatus) %>%
  summarise(total = n()) %>%
  mutate(percent = round(total / sum(total), 4)*100) %>%
  arrange(desc(total)))
```

55% of all respondents who said they are learning data science said they are "focused on learning mostly data science skills" with the other 45% saying that "data science is a small part of what I’m focused on learning".

The ratio of respondents who said they are "focused on learning mostly data science skills" remains the same at about 55% regardless of whether or not they are enrolled in an academic program.

```{r echo=FALSE}
# Take a peek at the demographics of those who are learners...
kable(learner %>% 
  group_by(StudentStatus, LearningDataScience) %>%
  summarise(total = n()) %>%
  mutate(percent = round(total / sum(total), 4)*100) %>%
  arrange(desc(total)))
```

```{r message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}

learner.LPL <- likert(data.frame(learner.LP))
learner.JSL <- likert(data.frame(learner.JS))

employed.LPL <- likert(data.frame(employed.LP))
employed.WTL <- likert(data.frame(employed.WT))
employed.WML <- likert(data.frame(employed.WM))
```


### Learning Platform Usefulness - 'Learners'

'Learners' think that the top 3 best ways to learn data science are through Courses, Projects and College with Arxiv and YouTube coming in 4th and 5th respectively.  

```{r echo=FALSE}
plot(learner.LPL)
kable(summary(learner.LPL))
```

### Learning Platform Usefulness - Employed Data Scientists

Employed Data Scientists agree with unemployed 'Learners' that Projects and Courses belong in the top 3, but put College in 5th place (vs. 3rd).  They also include Tutoring and SO (Stack Overflow Q&A) in their top 5 with SO coming in 2nd place.  YouTube (learner's 5th choice) comes in 14th place for employed Data Scientists and Arxiv (learner's 4th choice) is 8th among employed Data Scientists. 

Another interesting difference is that the importance of Friends to learning data science is much higher among employed Data Scientists with about 46.5% saying that Friends are "Very useful" and 97.5% saying that Friends are either "Somewhat useful" or "Very useful" vs. 'Learners' who put Friends at absolute bottom of their list with only 17.6% saying that they are are "Very useful" and 82.4% saying that Friends are either "Somewhat useful" or "Very useful".  

This may indicate a need to create a more robust community for Data Science 'Learners', who may feel somewhat isolated in their studies vs. employed Data Scientists who presumably have more established work and social networks that involve Data Science.  

```{r echo=FALSE}
plot(employed.LPL)
kable(summary(employed.LPL))
```

### Job Skills Importance to 'Learners'

'Learners' put Python at the top of their list of Job Skills with 63.6% of respondents saying that it is "Necessary" and 99% saying it is either "Necessary" or "Nice to have".  Only 1% said it was "Unnecessary".  R is surprisingly further down the list with only a little more than half as many respondents saying that R is "Necessary" compared to Python at 34.7% but many more agreeing that it is at least "Nice to have" for a total of 95% in favor of learning R which is just slightly less than those in favor of Python.

Surprisingly "Data Visualization" comes in only slightly above R with 39% saying that it is "Necessary" but actually slightly lower in terms of overall importance with 8% saying it is "Unnecessary".

```{r echo=FALSE}
plot(learner.JSL)
kable(summary(learner.JSL))
```

### Work Tools Frequency

Not surprisingly I guess, Python is also high on the list of tools that working Data Scientists use with 75.4% of users saying that they use it either "Often" or "Most of the time" and only Statistica, SQL and Unix edging it out for the top 3 slots.  What is surprising is that two of the the top three tools used in the field aren't even on the list of Job Skills 'Learners' were asked to evaluate.

R comes in slightly lower than Python with 63.6% of users saying that they use it either "Often" or "Most of the time" but the difference between R and Python is less in the field than what 'Learners' seem to think is most important.

```{r echo=FALSE}
plot(employed.WTL)
kable(summary(employed.WTL))
```

### Work Methods Frequency

The big surprise here is that Data Visualization is at the top of the list.  With nobody saying that they use it "Rarely" and only 8.5% saying that they only use it "Sometimes".  91.5% say they use it "Often" or "Most of the time".  It is by far the most frequently used method or tool for working Data Science Professionals with Statstica as the next runner up at only 80% by comparison.  Remember that only 38.8% of 'Learners' said that they thought Visualizations were a "Necessary" job skill to learn!  

```{r echo=FALSE}
plot(employed.WML)
kable(summary(employed.WML))
```



# Research Question 5

Is there any interaction between the Kaggle survey takers' program language use (R or Python) and their recommended program languages? (e.g. R users recommending R more than Python users recommending Python) (Burcu)

## Variables and their definition 

This section will describe the name of the variables and their labels (as reported in schema doc) and how the values were codes (etc yes, no, select all)

## Manipulating data


```{r ,fig.height = 8, fig.width = 8, fig.align = "center" , message= FALSE}
dim(MC)
tb1<-MC %>%
  select (id, WorkToolsSelect) %>%
  filter (id %in% c(1:6))
   datatable(tb1)
   

#removing NAs and empty values in  column=WorkToolsSelect
df <- MC[!(MC$WorkToolsSelect == "" | is.na(MC$WorkToolsSelect)), ]
dim(df)
tb2<-df %>%
  select (id, WorkToolsSelect) %>%
  filter (id %in% c(1:6))
   datatable(tb2)

#creating a new variable called work_tools where the original column values are split 
#please note that this code will generate long data   
df1<-df %>%
  mutate(work_tools = strsplit(as.character(WorkToolsSelect), ",")) %>%
  unnest(work_tools)

  #check 
tb3<-df1 %>%
  select (id, WorkToolsSelect,work_tools) %>%
  filter (id %in% c(1:3))
   datatable(tb3)

 df2<-df1  %>%
 group_by(id, work_tools) %>%
  summarize (total_count = n())   %>%
    spread( work_tools, total_count, fill=0) 


df3<-df2 %>%
 mutate(lang_use = case_when (
               (R==1 & Python==0) ~ "Using R Only",
               (R==0 & Python==1) ~ "Using Python only",
               (R==1 & Python==1) ~ "Using Both Python and R",
               (R==0 & Python==0) ~ "Using Neither Python nor R"))%>%
  select (id, R, Python, lang_use)

tb4<-df3 %>%
filter (id %in% c(1:10))
datatable(tb4)

#computing percentages
df4<-df3 %>%
group_by(lang_use) %>%
summarize (total_count = n()) %>%
mutate(percent = ((total_count / sum(total_count)) * 100), percent=round(percent, digit=2))

 #checking
datatable(df4, colnames=c("Programming Language Survey takers use", "Count", "Percent"),class = 'cell-border stripe',caption = 'Table 1: Descriptive Statistics',options = list(pageLength = 2, dom = 'tip'))


p<-ggplot (df4, aes(x=lang_use,y=percent,fill=lang_use )) +
geom_bar(stat="identity", width =.5) +
labs (x="Language ", y="The distribution of R and Python among their users (%) " ,
      title="Bar Graph of R and Python users") +
theme(axis.text.x = element_text(angle = 90)) +
scale_y_continuous (breaks=seq(0,100,10), limits = c(0,100))

#ggplotly(p)
p


```

Let's examine the above graph by LanguageRecommendationSelect

```{r ,fig.height = 10, fig.width = 10, fig.align = "center" , message= FALSE}

 #check 
tb5<-df1 %>%
  select (id, WorkToolsSelect,work_tools, LanguageRecommendationSelect) %>%
  filter (id %in% c(1:3))
   datatable(tb5)

 df5<-df1  %>%
 group_by(id, work_tools,LanguageRecommendationSelect) %>%
  summarize (total_count = n())   %>%
    spread( work_tools, total_count, fill=0) %>%
 mutate(lang_use = case_when (
               (R==1 & Python==0) ~ "Using R Only",
               (R==0 & Python==1) ~ "Using Python only",
               (R==1 & Python==1) ~ "Using Both Python and R",
               (R==0 & Python==0) ~ "Using Neither Python nor R"),
        lang_rec = case_when (
               (LanguageRecommendationSelect=="R") ~ "Recommending R ",
               (LanguageRecommendationSelect=="Python" ) ~ "Recommending Python ",
               (LanguageRecommendationSelect!="R" |LanguageRecommendationSelect!="Python") ~ "Recommending Neither Python nor R",
               (LanguageRecommendationSelect=="NA"|LanguageRecommendationSelect==" " ) ~ "Recommending Nothing"))%>%
select (id, R, Python, lang_use,lang_rec )

 dim(df5)
 
tb6<-df5 %>%
filter (id %in% c(1:10))
datatable(tb6)

 #computing percentages
df6<-df5 %>%
group_by(lang_use,lang_rec) %>%
summarize (total_count = n()) %>%
mutate(percent = ((total_count / sum(total_count)) * 100), percent=round(percent, digit=2))

#checking
datatable(df6, colnames=c("Programming Language Survey takers use", "Count", "Percent"),class = 'cell-border stripe',caption = 'Table 1: Descriptive Statistics',options = list(pageLength = 2, dom = 'tip'))


p1<-ggplot (df6, aes(x=lang_use,y=percent,fill=lang_use )) +
geom_bar(stat="identity", width =.5) +
labs (x="Language ", y="The distribution of R and Python among their users (%) " ,
title="Bar Graph of R and Python users and their recommended language") +
theme(axis.text.x = element_text(angle = 90)) +
scale_y_continuous (breaks=seq(0,100,10), limits = c(0,100))+
  facet_wrap(~lang_rec)+
  theme(legend.position = 'none')

#ggplotly(p1)
p1
```

## Results of RQ5:


We found that *a little below the half of the survey takers* (N=3540, 44.5%) reported to use both R and Python. The take home message for the aspiring data scientists is that substantial majority of the Kaggle survey takers are using both languages, both languages are used widely. Among the remaining half of the respondents, small portion of them (N=714, 8.98%) are using neither Python nor R. The rest of the survey takers are using either R or Python. In particular, 2533 (31.84%) indicated using only Python while only 1168 (14.68%) of them noted to use R Only.

The story of this contentious debate on R vs Python gets more interesting as to comparing their used languages with their recommended languages. Specifically, it is plausible to assume that Python users will recommend Python while R users will recommend R. Can we explore this hypothesis ? How much degree of difference among the Python and R users as to their recommended languages ?

Our results revealed that 72.17 % of the Python users recommended Python while 53.77% of R users recommended R. This results is not surprising to our hypothesis. Since there are more Python only users than R only users in this sample, it makes sense to have differences in their recommendation. However, what is surprising is degree of difference in their recommendation for the other language. For example, 15.92 % of the R users recommending Python whereas only 1.42 % of the Python users are recommending R. 

However, this results should be interpreted carefully because we have survey takers who did not make any recommendation. For instance 18.87 % of the sample who are Python users did not respond this question. Similarly, 17.55 % of R users did not leave any opinion on their recommended languages. If these Python users would say any recommendation, would that increase overall Python users' recommendation of R? Who knows?

Since half the sample included both R and Python users, let's see their recommendation. The 51.72% of them recommending Python while 25.65% of them recommending R. The quarter of the both users are recommending R but Python.


The moral of the story on this contentious debate on R vs Python  
+ Half of the sample uses both R and Python  
+ R only to Python only users are in 1:2 ratio  
+ More R users recommended Python than the Python users recommended R. 
+ Both users recommendations in Python is more than their recommendation in R. 



## Exploratory Data Analysis (EDA)

# Research Question6

Of those receiving pay in US Dollars, is Python or R overall most profitable for a Kaggle survey taker? (Gabby)

## Variables and their definition

This section will describe the name of the variables and their labels (as reported in schema doc) and how the values were codes (etc yes, no, select all)

## Manipulating data

```{r}
RQ6 <- MC %>%
  mutate(work_tools = strsplit(as.character(WorkToolsSelect), ",")) %>% 
  unnest(work_tools)

RQ6 <- RQ6 %>%
  filter(!is.na(WorkToolsSelect)) %>%  # Filters out all columns with NA in the WorkToolsSelect column
  filter(CompensationCurrency == "USD") %>% # Makes sure to only use rows whose currency is in USD
  filter(work_tools == "Python" | work_tools == "R") %>% # The work tools are R or Python, period.
  select(id, work_tools, CompensationAmount) # Only have three rows to work with
RQ6_ids <- select(filter(as.data.frame(table(RQ6$id)), Freq == 1), Var1) # Only want people who use R or Python EXCLUSIVELY, not R and/or Python
RQ6_ids <- droplevels(RQ6_ids)$Var1 # Removed the levels so we can actually get the IDs
RQ6 <- filter(RQ6, id %in% RQ6_ids) # Only keep those rows whose id are inside of list of ids with R or Python exclusively used at work
RQ6 <- select(RQ6, -id) # No use for the ID anymore, it's done its job
RQ6$CompensationAmount <- gsub(",", "", RQ6$CompensationAmount) # Removed the commas from the compensation amount to prep for numeric transformation
RQ6$CompensationAmount <- as.numeric(RQ6$CompensationAmount) # made the column into a numeric for easier mathematical comparison and sorting
RQ6 <- filter(RQ6, CompensationAmount < 9999999) # ... let's just be a little realistic, nobody is earning more than fifteen million a year at this point in time or prior to it, and this one-dollar-off-from-a-million entry is an anomaly in the data set
RQ6.summary <- rbind(summary(select(filter(RQ6, work_tools=="Python"), CompensationAmount)[[1]]), summary(select(filter(RQ6, work_tools=="R"), CompensationAmount)[[1]])) # Summary of the data
RQ6.summary <- as.data.frame(RQ6.summary)
colnames(RQ6.summary) <- c("Minimum", "1st Quartile", "Median", "Mean", "3rd Quartile", "Maximum") # Renamed the columns
RQ6.summary["Standard Deviation"] <- c( sd(filter(RQ6, work_tools == "Python")$CompensationAmount), sd(filter(RQ6, work_tools == "R")$CompensationAmount) )
RQ6.summary <- as.data.frame(sapply(RQ6.summary, function (x) paste("$", formatC(x, digits=2, format="f", big.mark=","), sep="") )) # Made all of the items in the data frame into dollar format
rownames(RQ6.summary) <- c("Python", "R") # Applied the rownames
rm(RQ6_ids) # remove the now-unused variable to save memory
```

## Exploratory Data Analysis (EDA)

```{r}
RQ6_boxplot <- ggplot(RQ6) +
  geom_boxplot( aes(x = factor(work_tools), 
                    y = CompensationAmount,
                    fill = factor(work_tools)
                     )
                  ) +
  scale_y_continuous(breaks=seq(0,2000000,25000)) +
  labs( x = "Programming Language",
        y = "Annual Compensation in USD",
        fill = "Programming Language")
RQ6_boxplot_ylim <- boxplot.stats(RQ6$CompensationAmount)$stats[c(1, 5)]
RQ6_boxplot <- RQ6_boxplot + coord_cartesian(ylim = RQ6_boxplot_ylim*1.05)
RQ6_boxplot
```

As we can see from the boxplots there is relatively normal distribution present in the compensation for those who solely used Python in their work. Conversely, there is a noticeable right skew in the compensation for those who solely used R in their work.

```{r}
knitr::kable(RQ6.summary)
```

The average survey taker who used Python in their job made approximately \$`r formatC(colMeans(select(filter(RQ6, work_tools=="Python"),CompensationAmount))-colMeans(select(filter(RQ6, work_tools=="R"),CompensationAmount)), digits=2, format="f", big.mark=",")` more than the average survey taker who used R in their job. While R users overall had a higher base pay - to the tune of $`r formatC(quantile(select(filter(RQ6, work_tools=="R"),CompensationAmount)[[1]])["25%"]-quantile(select(filter(RQ6, work_tools=="Python"),CompensationAmount)[[1]])["25%"], digits=2, format="f", big.mark=",")` more than their Python counterparts - their ability to achieve growth in salary was noticeably stymied in comparison. Outliers aside, if the data collected is to be considered representative of the data science population, there is indication that a prospective Data Scientist should learn R first for a higher initial salary, and then learn Python to increase their chance of obtaining a job with more growth potential.
